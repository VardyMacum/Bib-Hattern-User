<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>PatternTrader Pro</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fffafa; overflow-x: hidden; }
    header { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #1f2937; color: #fff; }
    footer { text-align: center; padding: 1rem; color: #777; }
    main {
      display: flex;
      flex-direction: column;
      max-width: 1000px;
      margin: 2rem auto;
      gap: 1.5rem;
      transition: margin-left 0.3s;
      padding: 0 1rem;
    }

    #hamburger { font-size: 1.5rem; cursor: pointer; margin-right: 1rem; }

    .side-panel {
      position: fixed;
      top: 0; left: -250px;
      width: 250px; height: 100%;
      background: #111; color: #eee;
      display: flex; flex-direction: column; padding: 2rem 1rem;
      gap: 1rem; transition: left 0.3s;
      z-index: 1000;
    }
    .side-panel.open { left: 0; }
    .side-panel button {
      background: #3b82f6; border: none; color: #fff;
      padding: .75rem; border-radius: 4px; cursor: pointer;
    }
    .side-panel button:hover { background: #2563eb; }

    .card { background: #074d09a2; border-radius: 8px; padding: 1rem; }
    .chart-wrapper { position: relative; height: 400px; margin-bottom: 1rem; overflow: hidden; }

    #d3-chart { width: 100%; height: 100%; display: block; }
    .line { stroke: #cc0000; fill: none; stroke-width: 2; filter: drop-shadow(0 0 6px rgb(0, 204, 51)); }

    .pin { position: absolute; width: 12px; height: 12px; background: rgb(0, 255, 42); border-radius: 50%; box-shadow: 0 0 8px #ff0; animation: pulse 1s ease-out infinite; pointer-events: none; }
    @keyframes pulse {
      0% { transform: translate(-6px, -6px) scale(1); opacity: 1; }
      50% { transform: translate(-6px, -6px) scale(1.4); opacity: 0.6; }
      100% { transform: translate(-6px, -6px) scale(1); opacity: 1; }
    }

    .controls { display: flex; flex-wrap: wrap; align-items: center; gap: 1rem; margin-top: 1rem; }
    input[type=number], button { padding: .5rem; border-radius: 4px; border: 1px solid #ccc; }
    .buy, .sell { padding: 1rem 2rem; font-size: 1rem; font-weight: bold; border-radius: 6px; border: none; cursor: pointer; transition: transform .2s; }
    .buy { background: #10b981; color: #fff; } .sell { background: #ef4444; color: #fff; }
    .buy:hover, .sell:hover { transform: scale(1.05); }

    .stats { display: flex; justify-content: space-around; margin-top: 1rem; flex-wrap: wrap; }
    .stat { background: #000000; padding: .75rem 1rem; border-radius: 4px; flex: 1; text-align: center; margin: .25rem; }

    .trades-log ul { list-style: none; padding: 0; max-height: 250px; overflow-y: auto; }
    .trades-log li { display: flex; justify-content: space-between; padding: .5rem 0; border-bottom: 1px solid #eee; }

    .popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.85); color: #fff; padding: 1rem 1.5rem; border-radius: 6px; font-size: 1.2rem; opacity: 0; pointer-events: none; transition: opacity .3s; }
    .popup.show { opacity: 1; }

    .tutorial-overlay { display: none; }
  </style>
</head>
<body>
  <header>
    <div id="hamburger">&#9776;</div>
    <h1>PatternTrader Pro</h1>
    <div>Balance: $<span id="balance">0.00</span></div>
  </header>

  <div class="side-panel" id="sidePanel">
    <div class="user-info" id="userInfo">User (ID)</div>
    <button onclick="panel('deposit')">Deposit</button>
    <button onclick="panel('withdraw')">Withdraw</button>
    <button onclick="panel('reset')">Reset</button>
    <button onclick="logout()">Log Out</button>
  </div>

  <main id="mainContent">
    <div class="card">
      <h2>Live Pattern Chart</h2>
      <div class="chart-wrapper"><svg id="d3-chart"></svg></div>
      <div class="controls">
        <label>Amount ($):<input type="number" id="trade-amount" min="1" value="1"></label>
        <button class="buy" onclick="placeTrade('buy')">Buy</button>
        <button class="sell" onclick="placeTrade('sell')">Sell</button>
      </div>
    </div>
<br></br>
    <div class="card">
      <h2>Stats & Trades</h2>
      <div class="stats">
        <div class="stat"><div>Traders</div><div id="traders-count">0</div></div>
        <div class="stat"><div>Buys</div><div id="buy-count">0</div></div>
        <div class="stat"><div>Sells</div><div id="sell-count">0</div></div>
      </div>
      <div class="trades-log"><h3>Trade History</h3><ul id="trades-list"></ul></div>
    </div>
  </main>

  <footer>&copy; <span id="year"></span> PatternTrader Pro</footer>
  <div class="popup" id="popup"></div>

<script src="https://console.firebase.google.com/u/0/project/trading-platform-5edc8/database/trading-platform-5edc8-default-rtdb/data/~2F.js"></script>


   <script>
    // Initialize Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAT12-ovGgcRBHvcPdlr5hmON_zABbD5HM",
  authDomain: "trading-platform-5edc8.firebaseapp.com",
  databaseURL: "https://trading-platform-5edc8-default-rtdb.firebaseio.com",
  projectId: "trading-platform-5edc8",
  storageBucket: "trading-platform-5edc8.firebasestorage.app",
  messagingSenderId: "445539056421",
  appId: "1:445539056421:web:6a31aa4c62351c5f9778cc",
    };
    // Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);


const database = firebase.database();

function save() {
  me.state = state;
  users = users.map(u => u.email === me.email ? me : u);
  localStorage.setItem('pt_users', JSON.stringify(users));
  
  // Save to Realtime Database under user ID or email (sanitize for keys)
  const userKey = me.email.replace('.', ',');  // Firebase keys can't have '.'
  database.ref('users/' + userKey).set(me)
    .then(() => console.log('Data saved to Firebase'))
    .catch(err => console.error('Firebase save error', err));
}

    // App State
    let traders = 0;
    let buyCount = 0;
    let sellCount = 0;
    let history = [];

    // UI Refs
    const traderCountEl = document.getElementById("trader-count");
    const buyCountEl = document.getElementById("buy-count");
    const sellCountEl = document.getElementById("sell-count");
    const historyListEl = document.getElementById("history-list");

    function updateUI() {
      traderCountEl.textContent = traders;
      buyCountEl.textContent = buyCount;
      sellCountEl.textContent = sellCount;
      if (historyListEl) {
        historyListEl.innerHTML = "";
        history.slice().reverse().forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          historyListEl.appendChild(li);
        });
      }
    }

    function syncToFirebase() {
      db.ref("trading").set({
        traders,
        buyCount,
        sellCount,
        history
      });
    }

    function loadFromFirebase() {
      db.ref("trading").on("value", snapshot => {
        const data = snapshot.val();
        if (data) {
          traders = data.traders || 0;
          buyCount = data.buyCount || 0;
          sellCount = data.sellCount || 0;
          history = data.history || [];
          updateUI();
        }
      });
    }

    function trade(type) {
      if (type === "buy") buyCount++;
      else sellCount++;
      const timestamp = new Date().toLocaleTimeString();
      const entry = `${timestamp} - ${type.toUpperCase()} executed`;
      history.push(entry);
      if (history.length > 50) history.shift(); // cap history
      updateUI();
      syncToFirebase();
    }

    function reset() {
      traders = Math.floor(Math.random() * 100);
      buyCount = 0;
      sellCount = 0;
      history = [];
      updateUI();
      syncToFirebase();
    }

    // Simulate trader fluctuation every 5s
    setInterval(() => {
      traders = Math.floor(Math.random() * 100);
      updateUI();
      syncToFirebase();
    }, 5000);

    // D3 Chart
    const svg = d3.select("#chart").append("svg").attr("width", "100%").attr("height", 300);
    const width = document.getElementById("chart").clientWidth;
    const height = 300;
    const data = Array(60).fill(50); // initial data points
    const x = d3.scaleLinear().domain([0, 59]).range([0, width]);
    const y = d3.scaleLinear().domain([0, 100]).range([height, 0]);
    const line = d3.line()
      .x((d, i) => x(i))
      .y(d => y(d))
      .curve(d3.curveBasis);

    const path = svg.append("path")
      .datum(data)
      .attr("fill", "none")
      .attr("stroke", "#00ffcc")
      .attr("stroke-width", 2);

    function updateChart() {
      data.push(Math.random() * 100);
      data.shift();
      path.datum(data)
        .attr("d", line);
    }

    setInterval(updateChart, 1000);

    // Init
    loadFromFirebase();
  </script>
</body>
</html>